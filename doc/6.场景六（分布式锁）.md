> ä¸»è¦ä¾é Redissonå®ç°åˆ†å¸ƒå¼é”ã€‚
>
> ------
>
> Redisson æ˜¯ä¸€ä¸ªåŸºäº **Java** çš„ **Redis å®¢æˆ·ç«¯**ï¼Œä½†å®ƒè¿œä¸æ­¢æ˜¯ä¸€ä¸ªç®€å•çš„å®¢æˆ·ç«¯â€”â€”å®ƒåœ¨ Redis åŸºç¡€ä¸Šå°è£…äº†å¤§é‡**åˆ†å¸ƒå¼å¯¹è±¡ã€æœåŠ¡å’Œå·¥å…·**ï¼Œè®©å¼€å‘è€…èƒ½åƒæ“ä½œæœ¬åœ° Java å¯¹è±¡ä¸€æ ·ï¼Œè½»æ¾å®ç°åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„å¸¸è§éœ€æ±‚ï¼ˆå¦‚åˆ†å¸ƒå¼é”ã€é™æµã€é˜Ÿåˆ—ã€å»¶è¿Ÿä»»åŠ¡ç­‰ï¼‰ã€‚
>
> ------
>
> ## ğŸŒŸ ä¸€ã€Redisson æ˜¯ä»€ä¹ˆï¼Ÿ
>
> - **å…¨ç§°**ï¼šRedis + sonï¼ˆæ„ä¸ºâ€œRedis çš„å„¿å­â€ï¼‰
> - **å®˜ç½‘**ï¼šhttps://redisson.org
> - **GitHub**ï¼šhttps://github.com/redisson/redisson
> - **è¯­è¨€æ”¯æŒ**ï¼šä¸»è¦ä¸º Javaï¼ˆä¹Ÿæœ‰ .NETã€Node.js ç­‰ç‰ˆæœ¬ï¼‰
> - **æ ¸å¿ƒç‰¹ç‚¹**ï¼š
>   - æä¾› **ä¸°å¯Œçš„åˆ†å¸ƒå¼ Java å¯¹è±¡**ï¼ˆMapã€Setã€Queueã€Lock ç­‰ï¼‰
>   - å†…ç½® **åˆ†å¸ƒå¼åè°ƒåŸè¯­**ï¼ˆå¦‚å¯é‡å…¥é”ã€å…¬å¹³é”ã€ä¿¡å·é‡ã€é—­é”ç­‰ï¼‰
>   - æ”¯æŒ **å¼‚æ­¥ã€å“åº”å¼ï¼ˆReactiveï¼‰ã€RxJava ç¼–ç¨‹æ¨¡å‹**
>   - è‡ªåŠ¨å¤„ç† **è¿æ¥ç®¡ç†ã€é‡è¿ã€é›†ç¾¤æ‹“æ‰‘æ„ŸçŸ¥**
>   - æ”¯æŒ **Redis æ‰€æœ‰éƒ¨ç½²æ¨¡å¼**ï¼šå•æœºã€ä¸»ä»ã€å“¨å…µã€é›†ç¾¤ã€äº‘æ‰˜ç®¡ï¼ˆAWS ElastiCacheã€é˜¿é‡Œäº‘ Redis ç­‰ï¼‰
>
> ------
>
> ## ğŸ”§ äºŒã€Redisson æ ¸å¿ƒåŠŸèƒ½
>
> ### 1. **åˆ†å¸ƒå¼é”ï¼ˆDistributed Locksï¼‰**
>
> è¿™æ˜¯ Redisson æœ€å¹¿ä¸ºäººçŸ¥çš„åŠŸèƒ½ï¼š
>
> | é”ç±»å‹                  | ç‰¹æ€§                                          |
> | ----------------------- | --------------------------------------------- |
> | `RLock`ï¼ˆå¯é‡å…¥é”ï¼‰     | åŒä¸€çº¿ç¨‹å¯å¤šæ¬¡åŠ é”ï¼Œè‡ªåŠ¨ç»­æœŸï¼ˆWatchdogï¼‰      |
> | å…¬å¹³é”                  | æŒ‰è¯·æ±‚é¡ºåºè·å–é”                              |
> | è”é”ï¼ˆMultiLockï¼‰       | åŒæ—¶é”å®šå¤šä¸ªèµ„æº                              |
> | çº¢é”ï¼ˆRedLockï¼‰         | è·¨å¤šä¸ª Redis å®ä¾‹çš„é«˜å¯ç”¨é”ï¼ˆäº‰è®®è¾ƒå¤§ï¼Œæ…ç”¨ï¼‰ |
> | è¯»å†™é”ï¼ˆReadWriteLockï¼‰ | æ”¯æŒå¹¶å‘è¯»ã€äº’æ–¥å†™                            |
>
> âœ… ç¤ºä¾‹ï¼š
>
> ```java
> RLock lock = redisson.getLock("myLock");
> lock.lock(); // è‡ªåŠ¨ç»­æœŸ
> try {
>     // ä¸´ç•ŒåŒº
> } finally {
>     lock.unlock();
> }
> ```
>
> > ğŸ’¡ **Watchdog æœºåˆ¶**ï¼šé»˜è®¤æ¯ 10 ç§’è‡ªåŠ¨å»¶é•¿é”æœ‰æ•ˆæœŸï¼ˆåªè¦å®¢æˆ·ç«¯åœ¨çº¿ï¼‰ï¼Œé¿å…ä¸šåŠ¡æ‰§è¡Œæ—¶é—´è¿‡é•¿å¯¼è‡´é”æå‰é‡Šæ”¾ã€‚
>
> ------
>
> ### 2. **åˆ†å¸ƒå¼é›†åˆä¸æ•°æ®ç»“æ„**
>
> Redisson å°† Redis æ•°æ®ç»“æ„æ˜ å°„ä¸º Java å¯¹è±¡ï¼š
>
> | Redis ç»“æ„    | Redisson æ¥å£              | ç‰¹æ€§                   |
> | ------------- | -------------------------- | ---------------------- |
> | String        | `RBucket<T>`               | æ”¯æŒæ³›å‹ã€è¿‡æœŸæ—¶é—´     |
> | Hash          | `RMap<K, V>`               | æ”¯æŒæœ¬åœ°ç¼“å­˜ã€ç›‘å¬å˜åŒ– |
> | List          | `RList<E>`                 | åŒå‘é“¾è¡¨ï¼Œæ”¯æŒé˜»å¡æ“ä½œ |
> | Set           | `RSet<E>`                  | æ— åºé›†åˆ               |
> | Sorted Set    | `RScoredSortedSet<E>`      | å¸¦åˆ†æ•°æ’åº             |
> | Queue / Deque | `RQueue`, `RBlockingDeque` | é˜»å¡é˜Ÿåˆ—ã€å»¶è¿Ÿé˜Ÿåˆ—     |
> | Stream        | `RStream`                  | Redis 5.0+ æµæ”¯æŒ      |
>
> âœ… ç¤ºä¾‹ï¼šåˆ†å¸ƒå¼ Map
>
> ```java
> RMap<String, User> userMap = redisson.getMap("users");
> userMap.put("alice", new User("Alice"));
> User u = userMap.get("alice");
> ```
>
> ------
>
> ### 3. **åˆ†å¸ƒå¼æœåŠ¡ï¼ˆDistributed Servicesï¼‰**
>
> - **åˆ†å¸ƒå¼è°ƒåº¦å™¨ï¼ˆRScheduledExecutorServiceï¼‰**
>    ç±»ä¼¼ `ScheduledExecutorService`ï¼Œä½†ä»»åŠ¡åˆ†å¸ƒæ‰§è¡Œã€‚
> - **åˆ†å¸ƒå¼è¿œç¨‹æœåŠ¡ï¼ˆRemote Serviceï¼‰**
>    é€šè¿‡ Redis å®ç° RPC è°ƒç”¨ï¼ˆè¾ƒå°‘ç”¨ï¼‰ã€‚
> - **å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆRBloomFilterï¼‰**
>    é«˜æ•ˆåˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨ï¼ˆé˜²ç¼“å­˜ç©¿é€ï¼‰ã€‚
> - **é™æµå™¨ï¼ˆRRateLimiterï¼‰**
>    åˆ†å¸ƒå¼ä»¤ç‰Œæ¡¶ç®—æ³•ï¼Œç”¨äºæ¥å£é™æµã€‚
>
> ```java
> RRateLimiter limiter = redisson.getRateLimiter("apiLimiter");
> limiter.trySetRate(RateType.OVERALL, 100, 1, RateIntervalUnit.MINUTES);
> if (limiter.tryAcquire()) {
>     // å¤„ç†è¯·æ±‚
> }
> ```
>
> ------
>
> ### 4. **é«˜çº§ç‰¹æ€§**
>
> | åŠŸèƒ½                        | è¯´æ˜                                  |
> | --------------------------- | ------------------------------------- |
> | **äº‹åŠ¡æ”¯æŒ**                | æ”¯æŒ Redis äº‹åŠ¡ï¼ˆ`RT transaction()`ï¼‰ |
> | **Lua è„šæœ¬**                | å®‰å…¨æ‰§è¡ŒåŸå­è„šæœ¬                      |
> | **æœ¬åœ°ç¼“å­˜ï¼ˆLocal Cacheï¼‰** | å‡å°‘ç½‘ç»œå¼€é”€ï¼ˆå¦‚ `RLocalCachedMap`ï¼‰  |
> | **ç›‘å¬å™¨ï¼ˆListenerï¼‰**      | ç›‘å¬ key è¿‡æœŸã€ä¿®æ”¹ç­‰äº‹ä»¶             |
> | **Spring é›†æˆ**             | æä¾› `redisson-spring-boot-starter`   |
>
> ------
>
> ## âš™ï¸ ä¸‰ã€æ”¯æŒçš„ Redis éƒ¨ç½²æ¨¡å¼
>
> Redisson å…¼å®¹æ‰€æœ‰ä¸»æµ Redis æ¶æ„ï¼š
>
> - å•æœºï¼ˆSingleï¼‰
> - ä¸»ä»ï¼ˆMaster-Slaveï¼‰
> - å“¨å…µï¼ˆSentinelï¼‰
> - é›†ç¾¤ï¼ˆClusterï¼‰
> - äº‘æœåŠ¡ï¼ˆAWS ElastiCache, Azure Cache, é˜¿é‡Œäº‘ Redis ç­‰ï¼‰
>
> é…ç½®ç¤ºä¾‹ï¼ˆYAMLï¼‰ï¼š
>
> ```java
> # é›†ç¾¤æ¨¡å¼
> clusterServersConfig:
>   nodeAddresses:
>     - "redis://192.168.1.10:7000"
>     - "redis://192.168.1.11:7001"
>   password: mypass
> ```

------

## 1. ä¾èµ–å¼•å…¥

```xml
        <dependency>
            <groupId>org.redisson</groupId>
            <artifactId>redisson-spring-boot-starter</artifactId>
            <version>3.41.0</version>
        </dependency>
```

## 2.é…ç½®

```yml
server:
  port: 9005

## å•æœº
spring:
  redis:
    host: localhost
    port: 6379
    password: redis
```

## 3.æœåŠ¡å®ç°

```java
@Service
public class ReportService {

    private static final Logger log = LoggerFactory.getLogger(ReportService.class);
    @Resource
    private RedissonClient redissonClient;


    public void generateDailyReport() {
        RLock lock = redissonClient.getLock("dailyReportLock");
        try {
            // å°è¯•è·å–é”ï¼Œæœ€å¤šç­‰å¾…3ç§’ï¼Œé”çš„è‡ªåŠ¨è¿‡æœŸæ—¶é—´è®¾ç½®ä¸º10ç§’
            if (lock.tryLock(3, 10, TimeUnit.SECONDS)) {
                // æ‰§è¡Œç”Ÿæˆæ—¥æŠ¥è¡¨çš„æ“ä½œ
                log.info("Generating daily report...");
                // æ¨¡æ‹Ÿé•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡
                TimeUnit.SECONDS.sleep(5);
                log.info("Daily report generated.");
            }
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
        } finally {
            // é‡Šæ”¾é”
            lock.unlock();
        }
    }
}
```

> [!NOTE]
>
> è¿™é‡ŒæŒ‰ç…§éœ€æ±‚åº”è¯¥è¿˜å¯ä»¥æ·»åŠ å¹‚ç­‰åˆ¤æ–­
>
> ```Java
> Boolean alreadyGenerated = redissonClient.getBucket(statusKey).isExists();
> ```

## 4.æ§åˆ¶å™¨

```java
@RestController
public class ReportController {

    @Resource
    private ReportService reportService;

    @GetMapping("/daily")
    public ResponseEntity<String> generateDailyReport() {
        reportService.generateDailyReport();
        return ResponseEntity.ok("Daily report generation triggered.");
    }
}
```

## 5.è¯·æ±‚è¾“å‡º

> **GET** `localhost:9005/daily`

> [!IMPORTANT]
>
> åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œä½¿ç”¨ **Redis + Lua è„šæœ¬å®ç°åŠ é”** ä¸ **ä½¿ç”¨æ™®é€šå‘½ä»¤ï¼ˆå¦‚ SETNX + EXPIREï¼‰åŠ é”** æœ‰æœ¬è´¨åŒºåˆ«ï¼Œæ ¸å¿ƒåœ¨äº **åŸå­æ€§ï¼ˆAtomicityï¼‰** å’Œ **å¯é æ€§**ã€‚ä¸‹é¢ä»åŸç†ã€å®‰å…¨æ€§ã€å®ç°å¤æ‚åº¦ç­‰ç»´åº¦è¯¦ç»†å¯¹æ¯”ã€‚
>
> ------
>
> ## ğŸ”‘ ä¸€ã€æ™®é€šåŠ é”ï¼ˆé Luaï¼‰çš„é—®é¢˜
>
> ### å¸¸è§é”™è¯¯å†™æ³•ï¼ˆä¸æ¨èï¼‰ï¼š
>
> ```java
> // ä¼ªä»£ç 
> if (redis.setnx("lock", "1")) {
>     redis.expire("lock", 10); // è®¾ç½®è¿‡æœŸæ—¶é—´
>     // æ‰§è¡Œä¸šåŠ¡
>     redis.del("lock");
> }
> ```
>
> ### âŒ é—®é¢˜ï¼š**éåŸå­æ“ä½œ**
>
> - `SETNX` å’Œ `EXPIRE` æ˜¯**ä¸¤æ¡ç‹¬ç«‹å‘½ä»¤**
> - å¦‚æœåœ¨ `SETNX` æˆåŠŸåã€`EXPIRE` æ‰§è¡Œå‰ï¼Œ**æœåŠ¡å´©æºƒæˆ–æ–­ç”µ** â†’ é”**æ°¸è¿œä¸ä¼šè¿‡æœŸ** â†’ **æ­»é”ï¼**
>
> > è¿™æ˜¯åˆ†å¸ƒå¼é”æœ€ç»å…¸çš„é™·é˜±ã€‚
>
> ------
>
> ## âœ… äºŒã€Lua è„šæœ¬åŠ é”çš„ä¼˜åŠ¿ï¼š**åŸå­æ€§**
>
> Redis ä¿è¯ **Lua è„šæœ¬æ‰§è¡Œæ˜¯åŸå­çš„**ï¼ˆå•çº¿ç¨‹æ‰§è¡Œï¼ŒæœŸé—´ä¸ä¼šè¢«å…¶ä»–å‘½ä»¤æ‰“æ–­ï¼‰ã€‚
>
> ### æ­£ç¡®çš„ Lua åŠ é”è„šæœ¬ç¤ºä¾‹ï¼š
>
> ```lua
> -- åŠ é”è„šæœ¬ lock.lua
> if redis.call("GET", KEYS[1]) == ARGV[1] then
>     -- é”æ˜¯å½“å‰çº¿ç¨‹æŒæœ‰çš„ï¼Œå¯é‡å…¥
>     return redis.call("PEXPIRE", KEYS[1], ARGV[2])
> elseif redis.call("SET", KEYS[1], ARGV[1], "PX", ARGV[2], "NX") then
>     -- é¦–æ¬¡åŠ é”æˆåŠŸ
>     return 1
> else
>     -- åŠ é”å¤±è´¥
>     return 0
> end
> ```
>
> è°ƒç”¨æ–¹å¼ï¼ˆä¼ªä»£ç ï¼‰ï¼š
>
> ```java
> String lockKey = "myLock";
> String requestId = UUID.randomUUID().toString(); // å”¯ä¸€æ ‡è¯†
> Long expireTime = 30000L; // 30ç§’
> 
> Object result = redis.eval(lockScript, 
>     Collections.singletonList(lockKey), 
>     requestId, expireTime.toString());
> ```
>
> ### âœ… ä¼˜åŠ¿ï¼š
>
> 1. **åŸå­æ€§**ï¼šåŠ é” + è®¾ç½®è¿‡æœŸæ—¶é—´ **ä¸€æ­¥å®Œæˆ**ï¼Œæœç»æ­»é”ã€‚
> 2. **å®‰å…¨æ€§**ï¼šé€šè¿‡ `requestId` ç¡®ä¿ **åªæœ‰åŠ é”è€…æ‰èƒ½è§£é”**ï¼ˆé˜²æ­¢è¯¯åˆ åˆ«äººçš„é”ï¼‰ã€‚
> 3. **å¯é‡å…¥æ”¯æŒ**ï¼šè„šæœ¬å¯åˆ¤æ–­å½“å‰é”æ˜¯å¦å±äºè‡ªå·±ï¼Œå®ç°å¯é‡å…¥ã€‚
>
> ------
>
> ## ğŸ”“ ä¸‰ã€è§£é”ä¹Ÿè¦ç”¨ Luaï¼
>
> æ™®é€šè§£é”é”™è¯¯å†™æ³•ï¼š
>
> ```java
> if (redis.get("lock").equals(requestId)) {
>     redis.del("lock"); // âŒ ä¸¤æ­¥æ“ä½œï¼šå…ˆè¯»å†åˆ ï¼ŒéåŸå­ï¼
> }
> ```
>
> **é—®é¢˜**ï¼šåœ¨ `GET` å’Œ `DEL` ä¹‹é—´ï¼Œé”å¯èƒ½å·²è¿‡æœŸå¹¶è¢«åˆ«äººè·å–ï¼Œæ­¤æ—¶ä¼š**è¯¯åˆ åˆ«äººçš„é”**ï¼
>
> ### âœ… æ­£ç¡®è§£é” Lua è„šæœ¬ï¼š
>
> ```java
> -- unlock.lua
> if redis.call("GET", KEYS[1]) == ARGV[1] then
>     return redis.call("DEL", KEYS[1])
> else
>     return 0
> end
> ```
>
> è¿™æ ·ç¡®ä¿ **â€œåˆ¤æ–­ + åˆ é™¤â€ åŸå­æ‰§è¡Œ**ã€‚
>
> ------
>
> ## ğŸ†š å››ã€å¯¹æ¯”æ€»ç»“
>
> | ç‰¹æ€§           | æ™®é€šå‘½ä»¤åŠ é”ï¼ˆSETNX + EXPIREï¼‰ | Lua è„šæœ¬åŠ é”                   |
> | -------------- | ------------------------------ | ------------------------------ |
> | **åŸå­æ€§**     | âŒ éåŸå­ï¼ˆå¤šæ¡å‘½ä»¤ï¼‰           | âœ… åŸå­ï¼ˆå•è„šæœ¬ï¼‰               |
> | **æ­»é”é£é™©**   | âš ï¸ é«˜ï¼ˆå¯èƒ½å¿˜è®°è®¾è¿‡æœŸï¼‰         | âœ… æ— ï¼ˆè¿‡æœŸæ—¶é—´å¿…è®¾ï¼‰           |
> | **è¯¯åˆ é”é£é™©** | âš ï¸ é«˜ï¼ˆè§£é”éåŸå­ï¼‰             | âœ… æ— ï¼ˆè§£é”åŸå­ï¼‰               |
> | **å¯é‡å…¥æ”¯æŒ** | âŒ éš¾å®ç°                       | âœ… å¯é€šè¿‡è„šæœ¬å®ç°               |
> | **æ€§èƒ½**       | ç•¥é«˜ï¼ˆå¤šæ¡å‘½ä»¤ï¼‰               | ç•¥ä½ï¼ˆè„šæœ¬è§£æå¼€é”€ï¼Œä½†å¯å¿½ç•¥ï¼‰ |
> | **å®ç°å¤æ‚åº¦** | ç®€å•ä½†æ˜“é”™                     | ç¨å¤æ‚ä½†å®‰å…¨                   |
>
> ------
>
> ## ğŸ§  äº”ã€Redisson æ˜¯å¦‚ä½•åšçš„ï¼Ÿ
>
> Redisson **åº•å±‚æ­£æ˜¯ä½¿ç”¨ Lua è„šæœ¬** å®ç°åˆ†å¸ƒå¼é”ï¼
>
> - åŠ é”ï¼š`org/redisson/redisson-lock.lua`
> - è§£é”ï¼š`org/redisson/redisson-unlock.lua`
> - æ”¯æŒï¼šå¯é‡å…¥ã€Watchdog è‡ªåŠ¨ç»­æœŸã€å…¬å¹³é”ç­‰
>
> âœ… æ‰€ä»¥ä½ ç”¨ Redisson æ—¶ï¼Œ**å·²ç»äº«å—äº† Lua è„šæœ¬çš„å®‰å…¨æ€§**ï¼Œæ— éœ€è‡ªå·±å†™è„šæœ¬ã€‚
>
> ------
>
> ## ğŸ›¡ï¸ å…­ã€æœ€ä½³å®è·µå»ºè®®
>
> 1. **æ°¸è¿œä¸è¦ç”¨ `SETNX + EXPIRE` åˆ†å¼€å†™**
>     â†’ æ”¹ç”¨ `SET key value PX milliseconds NX`ï¼ˆRedis 2.6.12+ æ”¯æŒï¼‰
>
>    ```bash
>    SET mylock my_random_value PX 30000 NX
>    ```
>
>    è¿™æ¡å‘½ä»¤**æœ¬èº«æ˜¯åŸå­çš„**ï¼Œå¯æ›¿ä»£ç®€å• Lua è„šæœ¬ã€‚
>
> 2. **ä½†å¤æ‚é€»è¾‘ï¼ˆå¦‚å¯é‡å…¥ã€ç»­æœŸï¼‰ä»éœ€ Lua**
>     â†’ æ¨èç›´æ¥ä½¿ç”¨ **Redisson**ï¼Œé¿å…é‡å¤é€ è½®å­ã€‚
>
> 3. **è§£é”å¿…é¡»æ ¡éªŒ value + åŸå­åˆ é™¤**
>     â†’ ç”¨ Lua æˆ– Redissonã€‚
>
> ------
>
> ## âœ… ç»“è®º
>
> | åœºæ™¯                           | æ¨èæ–¹æ¡ˆ                                |
> | ------------------------------ | --------------------------------------- |
> | ç®€å•åˆ†å¸ƒå¼é”                   | `SET key value PX 30000 NX`ï¼ˆåŸå­å‘½ä»¤ï¼‰ |
> | éœ€è¦å¯é‡å…¥ã€è‡ªåŠ¨ç»­æœŸã€å…¬å¹³é”ç­‰ | **Redissonï¼ˆåŸºäº Luaï¼‰**                |
> | è‡ªå·±å®ç°é”                     | **å¿…é¡»ç”¨ Lua è„šæœ¬ä¿è¯åŸå­æ€§**           |
>
> > ğŸ’¡ **è®°ä½**ï¼š
> >  **åˆ†å¸ƒå¼é”çš„å®‰å…¨æ€§ = åŸå­æ€§ + å”¯ä¸€æ ‡è¯† + è‡ªåŠ¨è¿‡æœŸ + å®‰å…¨è§£é”**
> >  è€Œ Lua è„šæœ¬æ˜¯å®ç°è¿™ä¸€åˆ‡çš„**æœ€å¯é æ‰‹æ®µ**ã€‚