> 使用Redis来存储用户会话信息，通常是为了实现分布式会话管理，即在多个应用服务器之间共享会话信息。

## 1. 引入依赖

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-data-redis</artifactId>
</dependency>
<dependency>
    <groupId>org.springframework.session</groupId>
    <artifactId>spring-session-data-redis</artifactId>
</dependency>
```

## 2.配置连接信息

```
server:
  port: 9001
  ## session 配置
  servlet:
    session:
      timeout: 1800
      persistent: false


spring:
  redis:
    host: localhost
    port: 6379
    password: redis

  session:
    store-type: redis  # 指定存储类型

```

## 3.会话配置

```java
@Configuration
@EnableRedisHttpSession // 核心注解，启用Redis存储Session
public class SessionConfig {
    
    // 配置JSON序列化器替代默认的JDK序列化，便于阅读和管理
    @Bean
    public RedisSerializer<Object> springSessionDefaultRedisSerializer() {
        // 使用FastJson
//        return new GenericFastJsonRedisSerializer();
//         或者使用Jackson
        return new GenericJackson2JsonRedisSerializer();
    }
    
    // (可选) 如果遇到跨项目共享Session问题，可配置Cookie路径
    @Bean
    public DefaultCookieSerializer defaultCookieSerializer() {
        DefaultCookieSerializer serializer = new DefaultCookieSerializer();
        serializer.setCookiePath("/"); // 设置为根路径，方便同域名下不同项目共享
        return serializer;
    }
}
```

## 4.控制器

```java
@RestController
public class TestController {

    @RequestMapping("/setSession")
    public String setSession(HttpServletRequest request) {
        HttpSession session = request.getSession();
        session.setAttribute("userName", "Lucy");
        session.setAttribute("age", 20);
        return "Session设置成功，sessionId: " + session.getId();
    }

    @RequestMapping("/getSession")
    public String getSession(HttpServletRequest request) {
        HttpSession session = request.getSession(false);
        if (session != null) {
            String userName = (String) session.getAttribute("userName");
            Integer age = (Integer) session.getAttribute("age");
            return "用户名: " + userName + ", 年龄: " + age + ", sessionId: " + session.getId();
        } else {
            return "Session不存在";
        }
    }
    
    @RequestMapping("/logout")
    public String logout(HttpServletRequest request) {
        HttpSession session = request.getSession(false);
        if (session != null) {
            session.invalidate(); // 使Session失效
        }
        return "登出成功";
    }
}
```

## 5.输出

[Apipost-基于协作, 不止于API文档、调试、Mock、自动化测试](https://docs.apipost.net/docs/detail/54662bc6ecca000?locale=zh-cn&target_id=639d80a347003)

> `localhost:9001/setSession `
>
> ```
> Session设置成功，sessionId: 333fcc3c-f192-40ee-8fdd-8baf1fdea376
> ```

> `localhost:9001/getSession`
>
> ```
> 用户名: Lucy, 年龄: 20, sessionId: 333fcc3c-f192-40ee-8fdd-8baf1fdea376
> ```

使用另外浏览器访问

```
Session不存在
```

## redis 会话存储信息

![image-20251103142824071](E:\document\中间件\缓存\assets\image-20251103142824071.png)